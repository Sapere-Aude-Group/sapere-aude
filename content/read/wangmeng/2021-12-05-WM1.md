---
title: EEG和MEG数据的非参数统计检验
author: 王萌
date: 2021-12-05
showDate: true 
showTOC: true
---

文献：Maris, E., & Oostenveld, R. (2007). Nonparametric statistical testing of EEG- and MEG-data. *Journal of Neuroscience Methods, 164*(1), 177-190. https://doi.org/10.1016/j.jneumeth.2007.03.024 

[原文](../Source_Files/2021-12-05-WM1.pdf)

# 1.MEEG数据处理的问题

## 1.1多重比较问题

MEEG数据是时间-空间（ spatiotemporal）结构的，在进行数据分析的时候需要解决的一个问题是多重比较问题。

多重比较问题MCP：因为研究兴趣在极大量的传感器－时间对（sensor－time　pair）上。由于大量的统计比较（即每个传感器-时间对一个比较），不可能通过在单个传感器-时间对水平上运行的标准统计程序来控制FWER。

FWER：错误地得出一个或多个传感器-时间对的实验条件之间存在差异的假设下的概率。（至少存在一个误报的概率。）

*举例：零假设是某人是否生病，p值小于α水平，得出“某人生病的结论”*

解决MCP问题需要将FWER控制在一个关键α水平（通常是0.05或0.01）

## 1.2生物学数据的特殊性

生物学数据的很多方面会因实验条件而异，因此对数据统计有很高的要求。

# 2.非参数检验

## 2.1适用范围

- 特定传感器的波形差异
- 特定时间点的地形图差异
- 整个时间-空间矩阵
- 频域表示

## 2.2 方法：例子-N400效应

### 1.各项条件可能有所不同的方面

- 先验知识：事先是否知道可能的效应的电极点和时间窗

1. 知道：进行单一t检验。得到p值。

2. 不知道：不能只计算多个t值，因为大量的统计比较不能和单一样本水平一样控制误报率（FWER），即多重比较问题MCP。MCP的解决方案是需要一个在一个关键的α水平上控制FWER的程序。

- 反应大脑机制的2种指标：

1. 诱发反应的调节

2. 大脑活动的震荡调节：用单个试次进行时间-空间数据的傅里叶/小波分析中获得的功率估计值来测量。

### 2.非参数检验流程

1. 收集一个数据集中2种实验条件的试次
2. 随机分区：随机把试次分成2个子集，对应2种条件，数量一致。
3. 计算检验统计量
4. 多次重复第2、3步，构建检验统计量的直方图
5. 根据实际的检验统计量和直方图计算随机分区的比例，这个比例是p值
6. 如果p值小于α水平，得出实验条件有显著差异的结论

置换检验：对于无限数量的随机分区，构建直方图是一种置换分布（permutation distribution）。p值也被称为置换p值，这种统计方法是置换检验（Permutation Test）。

（置换检验的例子和R代码：https://blog.csdn.net/u011467621/article/details/47971917）

随机化检验：和置换检验是一样的计算过程，但是原理不同。对于MEEG数据没有必要区分这两种检验类型。

- 实操：不是大量重复步骤2、3，而是使用蒙特卡洛模拟（Monte Carlo estimate）

置换p值的蒙特卡洛模拟是指观察到的检验统计量大于从排列分布中得到的值的随机分区的比例。蒙特卡洛p值的精度随从排列分布中提取的次数的增加而增加。蒙特卡洛p值具有二项式分布，其精度可以通过二项式比例的置信区间来量化。

### 3.和参数检验比较

1. 不依赖于数据的概率分布
2. 不依赖于选择的检验统计量，可以自由选择合适的检验统计量
3. 能简单解决MCP
4。 允许结合有关可预期效应的先验知识，帮助提高检验统计的敏感度

## 2.3.结果的呈现

### 1. 诱发反应

- 1.1 单一传感器分析

根据已有研究得到效应的时间-空间信息。

![图1](../Supporting_Information/2021-12-05-WM1-fig1.png)

c图：第一条线只进行t检验，第2条进行t检验和Bonferroni校正，第3条聚类检验（cluster mass test）。

- 聚类检验：一种fMRI的统计分析方法Bullmore et al.
(1999)，步骤如下：

1. 对每个样本，通过t值比较2种实验条件下试次的信号
2. 选择t值大于某个阈值的样本（这个阈值可能是基于也可能不基于零假设下t值的抽样分布，并不影响非参数检验的有效性）
3. 根据时间连接性将所选样本聚类
4. 计算聚类内总t值，得到聚类水平的统计量
5. 选择最大的聚类水平统计量

聚类检验依赖于选择样本的阈值，这个阈值不影响误报率，但是会影响检验的敏感度。*如果是反应弱但持续时间久的效应，在阈值较大的情况下无法被检测到*

**⾮参数统计检验是通过计算置换分布下的 p 值并与其与关键 α⽔平进⾏⽐较来执⾏的。**

- 1.2 多传感器分析

通常情况下是不知道效应会在哪个点出现的。相比单个传感器分析的大量时间样本，多传感器分析有大量传感器-时间。

需要计算多个特定样本的t值来评估效应的可靠性。也出现更大的MCP。对于如此大的样本，Bonferroni校正得到的是一个非常保守的统计检验。本文的样本数据中，没有样本的p值超过双侧α水平（ 0.025/90, 600 = 0.0000003）；相反，基于聚类的置换检验更加敏感。聚类检验：基于空间和时间选定样本进行聚类。

![图2](../Supporting_Information/2021-12-05-WM1-fig2.png)

### 2.震荡活动的调节

- 1.1 单一传感器分析

![图3：3种计算TFRs的方法](../Supporting_Information/2021-12-05-WM1-fig3.png)

TFRs：时频表征。

没有一个（频率、时间）特定的t值超过Bonferroni校正的alpha水平。相比之下，基于聚类的置换检验结果非常敏感。

- 1.2 多传感器分析

基于聚类的置换检验和单一电极的区别：根据光谱、时间和空间的连接性进行样本（频率、时间、传感器）的选择。

![图4](../Supporting_Information/2021-12-05-WM1-fig4.png)

# 3. 原理

未说明的问题1.零假设的确切说明；2.控制了误报率的证明；3.如何选择检验统计量

## 1.数据结构

### 1.1 单一被试研究

观察单位是不同条件下的试次，研究问题是条件对MEEG数据的影响

试次分配方案：

- 试次内：以特定顺序分给所有条件。

- 试次间：每个试次分别分配给多个条件之一（最常见）

自变量和因变量：

- 因变量：记录的EEG/MEG， 用D表示，假设是随机变量，D是随机过程的结果。实际的D值是d。

- 试次间的MEEG结果：因变量D是n个较小的数据结构成分D<sub>r<sub>（r=1,2,...n）的数值，每个值对应一个试次。D<sub>r<sub>是给定试次中的时间-空间数据矩阵。

- 自变量：不同的条件，实验条件的多种因素（刺激类型、任务类型、响应类型）。用I表示，是n个较小的数据结构成分I<sub>r<sub>（r=1,2,...n）的数值，I<sub>r<sub>表示不同条件。I既可以是随机的也可以是固定的。

## 2.零假设

### 2.1 公式：

基于试次特定数据D<sub>r<sub>的概率分布。f (Dr = dr)，所有Dr的概率分布相同， f(D1) = f (D2) =···= f (Dn).

即零假设涉及所有具有相同概率分布的数据结构Dr，与实验条件无关。

### 2.2 对误报率控制的强弱

Dr数据是时间-空间性的，所以零假设是MEEG的概率分布对所有的传感器-时间对都是相同的，如果否定零假设，那么说明概率分布是由一些传感器-时间对的实验条件决定的。不能将误报率控制在单个传感器-时间对的水平。

1. 空间维度

- 全局零假设：没有体素的实验条件之间没有差异

- 体素特异零假设：给定体素的实验条件之间没差异，但那会死其他体素的差异是未知的。如果可以控制所有体素错误拒绝体素特定的零假设的概率，那么就有很强的误报率控制。

MEEG数据区分全局假设和样本特异假设无意义，因为有空间相关性。如果样本特异假设对对应样本是假的，那么对其他的也是假的。

*信号源问题？*

2. 时间维度

单个时间点的零假设检验没有意义，因为效应持续时间涉及几十个或几百个时间点。但如果想强控制误报率，就需要对特定时间点进行零假设，这样会导致全局假设的敏感性降低。

综上，从空间和时间维度上看，应该进行全局零假设和相关的误报率的弱控制。

### 2.3 可交换性

因变量D的概率是可交换的，说明D的概率在数据结构中是不变的，也直接说明了置换检验的有效性。

## 3.置换检验

原则上（但在实践中不是），可以通过构建该假设下某个检验统计量的概率分布，并通过评估该分布下实际观察到的检验统计量来检验可交换性假设。然⽽，事实证明，构造检验统计量的特定条件概率分布要容易得多（也是在可交换性假设下）。此条件概率分布是排列分布，⽣成的统计检验是置换检验。

使用条件概率和无条件概率的误报率是相同的。

### 3.1 排列分布

一个4个试次的数据（d1,d2,d3,d4），有24种排列组合的方式。每种的概率相同。

常用随机分区（random partitions）：条件内的试次特定数据的顺序的检验统计量。试次对：（d1,d3),(d2,d4)，样本特定t值不依赖于试次对内的顺序。

不区分排列分布和分区分布，如果检验统计量和条件哪试次顺序无关，那么排列和分区是相同的。

### 3.2 条件P值

f (D)是因变量D的未知概率，在试次特定数据矩阵中的排列不变（因为有可交换性）。

- 排列分布：{D}={d} 

- 条件分布：f(D|{D}={d})，因为f (D)未知且可交换，所以f(D|{D}={d})就是d的排列，每个概率都相同。

统计检验的对象：D和I的函数（自变量和因变量），S（D，I）

基于条件分布已知的f(D|{D}={d})计算f(S（D，I）|{D}={d})，得到S（D，I）的条件分布，基于S（D，I）分布的直方图进行蒙特卡洛模拟得到p值，所以是条件P值。

控制误报率的原理：1.无序数据；2.可交换性；3.the probability of observing a p-value that is less than the critical alpha-level is exactly equal to the critical alpha-level

### 3.3无条件控制误报率

因为很难有{D}={d}，所以基于这种条件控制误报率的意义不大。

无论p值是否是条件性的，对每个事件{D}={d}，误报率=α水平，取f（D）的平均值，误报率仍等于α水平。

*条件反射原理*

### 3.4随机自变量的置换检验

随机自变量和固定自变量的计算相同。

### 3.5检验统计量的选择

非参数统计控制误报率不依赖于所使用的检验统计量

自由选择检验统计量的优势：
1. 简单解决MCP：不是单独评估每个样本的在实验条件之间的差异，而是在整个时间-频谱网络中使用单一检验统计量来评估。
2. 整合有关可预期的效应类型的先验知识：
*怎么定义先验知识？对当前研究数据的预处理观察到的波形差异算不算？*
3. 定位效应的空间、频谱、时间；
4. 使用有向量结果的检验统计量：几种不同效应同时发生的情况下使用。

# 4.多被试的置换检验

从每个被试的所有试次中取平均值，得到特定于被试的诱发反应/平均功率。
*ERPLAB计算平均ERPs*

被试间实验：和试验间的置换检验一致，区别在于计算是基于一组被试的被试特定平均值。样本量小的话要枚举，太小的话很难达到显著。

被试内实验：每个被试每个条件都有一个均值，统计量是配对样本t检验。

# 5.结论

聚类非参数检验优势，见上。

存在的问题：1.阈值的选择，如何选择阈值以获得未知效应的最大敏感度尚不清楚；2.聚类非参数检验的敏感度始终低于未校正的p值的敏感度。也说明聚类非参数检验以一些敏感度换取了误报率控制。
